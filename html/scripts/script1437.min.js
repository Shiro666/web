$("#shuoming1").show();$("#biaoji1").show();$("#errshuoming1").hide();$("#shuoming2").show();$("#biaoji2").show();$("#errshuoming2").hide();$("#shuoming3").show();$("#biaoji3").show();$("#errshuoming3").hide();$("#shuoming4").show();$("#biaoji4").show();$("#errshuoming4").hide();$("#shuoming5").show();$("#biaoji5").show();$("#errshuoming5").hide();var url=decodeURI(window.location.href);var argsIndex=url.split("?user_id=");var user_id=argsIndex[1];$("#reg_input1").bind("blur",function(){var b=$("#reg_input1").val();var a=/^[a-zA-Z0-9_\u4e00-\u9fa5]{3,18}$/;if(a.test(b)){$("#biaoji1").hide();$("#errshuoming1").hide();$("#shuoming1").html("&#10003").removeClass("shuoming").addClass("shuomingright").show()}else{$("#shuoming1").hide();$("#biaoji1").hide();if(b==""){$("#errshuoming1").html("！用户名不能为空").show()}else{if(b.length<3||b.length>18){$("#errshuoming1").html("！用户名应长度在3~18").show()}else{$("#errshuoming1").html("！用户名出现非法字符").show()}}}});$("#reg_input2").bind("blur",function(){var b=$("#reg_input2").val();var a=/^[1][3,4,5,7,8][0-9]{9}$/;if(a.test(b)){$("#biaoji2").hide();$("#errshuoming2").hide();$("#shuoming2").html("&#10003").removeClass("shuoming").addClass("shuomingright").show()}else{if(b==""){$("#shuoming2").hide();$("#biaoji2").hide();$("#errshuoming2").html("！手机号码不能为空").show()}else{$("#shuoming2").hide();$("#biaoji2").hide();$("#errshuoming2").html("！手机号码格式有误").show()}}});$("#reg_input3").bind("blur",function(){var a=$("#reg_input3").val();var b=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;if(b.test(a)){$("#biaoji3").hide();$("#errshuoming3").hide();$("#shuoming3").html("&#10003").removeClass("shuoming").addClass("shuomingright").show()}else{if(a==""){$("#shuoming3").hide();$("#biaoji3").hide();$("#errshuoming3").html("！邮箱不能为空").show()}else{$("#shuoming3").hide();$("#biaoji3").hide();$("#errshuoming3").html("！邮箱格式有误").show()}}});$("#reg_input4").bind("blur",function(){var a=$("#reg_input4").val();var b=/^[a-zA-Z0-9]{6,16}$/;if(b.test(a)){$("#biaoji4").hide();$("#errshuoming4").hide();$("#shuoming4").html("&#10003").removeClass("shuoming").addClass("shuomingright").show()}else{if(a=""){$("#errshuoming4").html("！密码不能为空").show()}else{$("#shuoming4").hide();$("#biaoji4").hide();if(a.length<6||a.length>16){$("#errshuoming4").html("！密码应长度在6~16").show()}else{$("#errshuoming4").html("！密码出现非法字符").show()}}}});$.ajax({type:"POST",url:"user_attr_init.php",async:false,data:{user_id:user_id},dataType:"json",success:function(a){$("#reg_input1").val(a[0].nickname);$("#reg_input2").val(a[0].phone_number);$("#reg_input3").val(a[0].email)},error:function(a,c,b){alert("状态码："+a.status+" 状态："+a.readyState+" 错误信息："+c)}});$("#reg_input3").autocomplete({delay:0,autoFocus:true,source:function(e,d){var g=["163.com","qq.com","gmail.com","126.com","yahoo.com","sohu.com","sina.com","hotmail.com","live.com"],c=e.term,a=c,i="",b=c.indexOf("@"),j=[];j.push(c);if(b>-1){a=c.slice(0,b);i=c.slice(b+1)}if(a){var h;if(i){h=$.grep(g,function(l,k){return l.indexOf(i)>-1})}else{h=g}var f=$.map(h,function(l,k){return a+"@"+l});j=j.concat(f)}d(j)}});$("#reg_submit").bind("click",function(){var g=$("#reg_input1").val();var f=$("#reg_input2").val();var e=$("#reg_input3").val();var d=$("#reg_input4").val();var c=decodeURI(window.location.href);var b=c.split("?user_id=");var a=b[1];if(!($("#shuoming4").hasClass("errshuoming"))&&!($("#shuoming3").hasClass("errshuoming"))&&!($("#shuoming2").hasClass("errshuoming"))&&!$("#shuoming1").hasClass("errshuoming")){$.ajax({type:"POST",url:"modify_user_attr.php",data:{user_id:a,nickname:g,phone_number:f,email:e,password:d},dataType:"json",success:function(h){if(h.status=="success"){alert("修改成功");$.cookie("nickname","",{expires:-1,path:"/"});$.cookie("password","",{expires:-1,path:"/"});$.cookie("phone_number","",{expires:-1,path:"/"});$.cookie("email","",{expires:-1,path:"/"});$.cookie("user_id","",{expires:-1,path:"/"});$.cookie("nickname",g,{path:"/",expires:7});$.cookie("phone_number",f,{path:"/",expires:7});$.cookie("email",e,{path:"/",expires:7});$.cookie("password",d,{path:"/",expires:7});$.cookie("user_id",a,{path:"/",expires:7});window.location.href="HOME.html"}else{if(h.status=="fail"){alert("修改失败，失败原因："+h.msg)}}},error:function(h,j,i){alert("状态码："+h.status+" 状态："+h.readyState+" 错误信息："+j)}})}});